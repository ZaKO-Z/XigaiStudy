<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <title>用户管理系统</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    /* Reset */
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: "Microsoft YaHei", "PingFang SC", "Helvetica Neue", Arial;
      background: #f0f2f5;
      color: #222;
    }

    /* Sidebar */
    .sidebar {
      position: fixed;
      left: 0;
      top: 0;
      bottom: 0;
      width: 220px;
      background: #001529;
      color: #fff;
      padding: 28px 18px;
    }
    .brand {
      display:flex; align-items:center; gap:10px; margin-bottom:24px;
    }
    .brand .logo {
      width:34px; height:34px; background:#12324a; border-radius:6px;
    }
    .brand h1 { font-size:18px; margin:0; font-weight:600; letter-spacing:0.5px; }

    .nav { margin-top:10px; }
    .nav-item {
      padding: 12px 8px;
      color: #d9e6f5;
      border-radius:6px;
      cursor:pointer;
      margin-bottom:6px;
    }
    .nav-item.active, .nav-item:hover { background: rgba(255,255,255,0.04); color:#fff; }

    /* Top of content area spacing */
    .app {
      margin-left:220px;
      padding: 28px 36px;
    }

    /* Page header style */
    .page-header {
      display:flex;
      align-items:center;
      justify-content:space-between;
      margin-bottom:18px;
    }
    .page-title { font-size:22px; font-weight:700; color:#111; }
    .section-tag {
      background:#2aa7d3; color:#fff;
      padding:8px 14px; border-radius:3px; box-shadow: 0 2px 0 rgba(0,0,0,0.06);
      font-weight:600;
    }

    /* User list card */
    #userList { margin-top:18px; }
    .user-card {
      background: #d7e776; /* 浅绿 */
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding: 18px;
      border-radius:6px;
      box-shadow: 0 6px 14px rgba(16,24,32,0.08);
      margin-bottom: 20px;
    }
    .user-left { display:flex; align-items:center; gap:18px; }
    .avatar {
      width:88px; height:88px; border-radius:50%; overflow:hidden;
      background:#fff; display:flex; align-items:center; justify-content:center;
    }
    .avatar img { width:100%; height:100%; object-fit:cover; display:block; }
    .user-meta { line-height:1.6; }
    .user-meta .name { font-size:20px; font-weight:700; color:#243033; margin-bottom:2px; }
    .user-meta .muted { color:#333; font-size:13px; }

    .card-actions { margin-left:20px; }
    .btn-edit {
      background:#1890ff; color:#fff; border:none; padding:10px 14px; border-radius:6px;
      cursor:pointer; font-weight:600; box-shadow: 0 2px 0 rgba(0,0,0,0.08);
    }
    .btn-edit:hover { background:#40a9ff; }

    /* Edit page layout - replicate your screenshot */
    .edit-wrap {
      display:none; /* toggle visible when editing */
      padding: 30px 36px;
      min-height: calc(100vh - 56px);
    }

    .edit-card {
      background:#fff;
      padding:36px 48px;
      margin: 18px auto;
      border-radius:6px;
      box-shadow: 0 6px 18px rgba(16,24,32,0.06);
      max-width:1100px;
    }

    .edit-title { font-size:20px; font-weight:700; margin-bottom:28px; color:#111; }

    .edit-body {
      display:flex;
      gap:40px;
      align-items:flex-start;
    }

    .edit-left { width:65%; }
    .edit-right { width:35%; text-align:center; }

    /* Form controls mimic screenshot */
    .form-row { margin-bottom:18px; }
    .form-row label {
      display:block;
      margin-bottom:8px;
      font-weight:600;
      color:#333;
    }
    .form-row input[type="text"],
    .form-row input[type="email"],
    .form-row input[type="password"],
    .form-row select,
    .form-row textarea {
      width:100%;
      padding:10px 12px;
      border:1px solid #e9ecef;
      border-radius:4px;
      font-size:14px;
      background:#fff;
      outline:none;
    }
    textarea { min-height:92px; resize:vertical; }

    /* right avatar area */
    .edit-right .avatar-large { width:140px; height:140px; margin: 6px auto 10px; border-radius:50%; overflow:hidden; }
    .edit-right .avatar-large img { width:100%; height:100%; object-fit:cover; display:block; }

    .upload-row { margin-top:10px; display:flex; justify-content:center; gap:12px; align-items:center; }
    .btn-upload {
      border:1px solid #e1e6ea; background:#fff; padding:8px 12px; border-radius:4px; cursor:pointer;
    }
    .btn-primary {
      display:inline-block;
      background:#1890ff; color:#fff; padding:8px 14px; border-radius:4px; border:none; cursor:pointer;
      font-weight:600;
    }
    .btn-primary:hover { background:#40a9ff; }
    .btn-link {
      color:#1890ff; text-decoration:underline; cursor:pointer; background:none; border:none; padding:0;
    }

    /* footer small */
    .page-footer { text-align:center; color:#889096; padding:22px 0; font-size:12px; margin-top:18px; }
    /* responsive */
    @media (max-width:900px){
      .edit-body { flex-direction:column; }
      .edit-left, .edit-right { width:100%; }
      .sidebar { display:none; }
      .app { margin-left:0; padding: 14px; }
      .edit-wrap, .app { padding: 14px; }
    }
  </style>
</head>
<body>
  <!-- Sidebar -->
  <div class="sidebar" aria-hidden="false">
    <div class="brand">
      <div class="logo"></div>
      <h1>AntDesign</h1>
    </div>
    <div class="nav">
      <div class="nav-item active">用户管理</div>
      <div class="nav-item">课程学习</div>
      <div class="nav-item">资源管理</div>
      <div class="nav-item">公告通知</div>
      <div class="nav-item">互动交流</div>
    </div>
  </div>

  <!-- Main app area -->
  <div class="app">
    <!-- User list page header -->
    <div id="list-page">
      <div class="page-header">
        <div>
          <div class="page-title">用户管理</div>
          <div style="height:8px"></div>
          <div class="section-tag">个人用户中心</div>
        </div>
        <div></div>
      </div>

      <div id="userList"></div>

      <div class="page-footer">© 2025 示例系统</div>
    </div>

    <!-- Edit page -->
    <div id="edit-page" class="edit-wrap" aria-hidden="true">
      <div class="edit-card">
        <div style="display:flex; align-items:center; justify-content:space-between;">
          <div class="edit-title">基本设置</div>
          <div>
            <button class="btn-link" id="backBtn">← 返回用户管理</button>
          </div>
        </div>

        <div class="edit-body">
          <div class="edit-left">
            <div class="form-row">
              <label for="inputEmail">邮箱</label>
              <input id="inputEmail" type="email" />
            </div>

            <div class="form-row">
              <label for="inputNickname">昵称</label>
              <input id="inputNickname" type="text" />
            </div>

            <div class="form-row">
              <label for="inputBio">个人简介</label>
              <textarea id="inputBio" placeholder="这个人很懒，什么都没留下"></textarea>
            </div>

            <div class="form-row">
              <label for="selectCountry">国家地区</label>
              <select id="selectCountry">
                <option>中国</option>
                <option>美国</option>
                <option>日本</option>
                <option>韩国</option>
              </select>
            </div>

            <div class="form-row" style="display:flex;gap:12px;">
              <div style="flex:1">
                <label>所在省</label>
                <select id="selectProvince">
                  <option>请选择省份</option>
                  <option>浙江省</option>
                  <option>广东省</option>
                  <option>北京市</option>
                </select>
              </div>
              <div style="flex:1">
                <label>所在市</label>
                <select id="selectCity">
                  <option>请选择城市</option>
                  <option>杭州市</option>
                  <option>广州市</option>
                  <option>北京市</option>
                </select>
              </div>
            </div>

            <div class="form-row">
              <label for="inputStudentId">学号</label>
              <input id="inputStudentId" type="text" />
            </div>

            <div class="form-row">
              <label for="inputPassword">密码</label>
              <input id="inputPassword" type="password" />
            </div>

            <div style="margin-top:6px;">
              <button class="btn-primary" id="saveBtn">更新信息</button>
            </div>
          </div>

          <div class="edit-right">
            <div style="text-align:left; font-weight:600; color:#333; margin-bottom:8px;">邮箱</div>
            <div class="avatar-large">
              <img id="avatarPreview" src="user.png" alt="avatar" />
            </div>

            <div class="upload-row">
              <input id="avatarInput" type="file" accept="image/*" style="display:none" />
              <button class="btn-upload" id="chooseAvatarBtn">更换头像</button>
              <button class="btn-upload" id="resetAvatarBtn">重置</button>
            </div>

            <div style="margin-top:16px; font-size:13px; color:#666;">
              支持 jpg/png，图片将保存在本地浏览器（localStorage）
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>

  <script>
    /**************
     * 数据与持久化
     **************/
    const STORAGE_KEY = 'user_management_users_v1';

    // 默认 4 个用户，头像引用同目录下的 user.png
    const defaultUsers = [
      { id:1, name:'张三', email:'zhangsan@school.edu', studentId:'20240001', province:'浙江省', city:'杭州市', country:'中国', password:'123456', bio:'喜欢编程和动漫。', avatar:'user.png' },
      { id:2, name:'李四', email:'lisi@school.edu', studentId:'20240002', province:'广东省', city:'广州市', country:'中国', password:'123456', bio:'热爱运动，擅长篮球。', avatar:'user.png' },
      { id:3, name:'王五', email:'wangwu@school.edu', studentId:'20240003', province:'北京市', city:'北京市', country:'中国', password:'123456', bio:'喜欢摄影与旅行。', avatar:'user.png' },
      { id:4, name:'赵六', email:'zhaoliu@school.edu', studentId:'20240004', province:'浙江省', city:'杭州市', country:'中国', password:'123456', bio:'负责前端开发。', avatar:'user.png' }
    ];

    function loadUsers() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return defaultUsers.slice();
        const parsed = JSON.parse(raw);
        if (!Array.isArray(parsed)) return defaultUsers.slice();
        return parsed;
      } catch(e) {
        console.warn('读取存储用户失败，使用默认数据', e);
        return defaultUsers.slice();
      }
    }
    function saveUsers(arr) {
      try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(arr));
      } catch(e) {
        console.warn('保存用户到 localStorage 失败', e);
      }
    }

    let users = loadUsers();
    let editingUserId = null;

    /**************
     * 列表渲染
     **************/
    const userListEl = document.getElementById('userList');

    function renderUserList() {
      userListEl.innerHTML = '';
      users.forEach(u => {
        const card = document.createElement('div');
        card.className = 'user-card';
        card.innerHTML = `
          <div class="user-left">
            <div class="avatar"><img src="${u.avatar}" alt="avatar"></div>
            <div class="user-meta">
              <div class="name">姓名：${escapeHtml(u.name)}</div>
              <div class="muted">邮箱：${escapeHtml(u.email)}</div>
              <div class="muted">学号：${escapeHtml(u.studentId)}</div>
            </div>
          </div>
          <div class="card-actions">
            <button class="btn-edit" data-id="${u.id}">修改用户信息</button>
          </div>
        `;
        userListEl.appendChild(card);
      });

      document.querySelectorAll('.btn-edit').forEach(btn=>{
        btn.addEventListener('click', ()=> openEdit(Number(btn.getAttribute('data-id'))));
      });
    }

    const listPage = document.getElementById('list-page');
    const editPage = document.getElementById('edit-page');

    const inputEmail = document.getElementById('inputEmail');
    const inputNickname = document.getElementById('inputNickname');
    const inputBio = document.getElementById('inputBio');
    const inputStudentId = document.getElementById('inputStudentId');
    const selectCountry = document.getElementById('selectCountry');
    const selectProvince = document.getElementById('selectProvince');
    const selectCity = document.getElementById('selectCity');
    const inputPassword = document.getElementById('inputPassword');

    const avatarInput = document.getElementById('avatarInput');
    const avatarPreview = document.getElementById('avatarPreview');
    const chooseAvatarBtn = document.getElementById('chooseAvatarBtn');
    const resetAvatarBtn = document.getElementById('resetAvatarBtn');
    const saveBtn = document.getElementById('saveBtn');
    const backBtn = document.getElementById('backBtn');

    chooseAvatarBtn.addEventListener('click', ()=> avatarInput.click());
    avatarInput.addEventListener('change', handleAvatarSelected);
    resetAvatarBtn.addEventListener('click', resetAvatarToDefault);
    saveBtn.addEventListener('click', handleSave);
    backBtn.addEventListener('click', ()=> showList());

    function openEdit(id) {
      const u = users.find(x=>x.id===id);
      if(!u) return alert('未找到该用户');
      editingUserId = id;

      inputEmail.value = u.email || '';
      inputNickname.value = u.name || '';
      inputBio.value = u.bio || '';
      inputStudentId.value = u.studentId || '';
      selectCountry.value = u.country || '中国';
      selectProvince.value = u.province || '';
      selectCity.value = u.city || '';
      inputPassword.value = u.password || '';
      avatarPreview.src = u.avatar || 'user.png';

      listPage.style.display = 'none';
      editPage.style.display = 'block';
      editPage.setAttribute('aria-hidden','false');
      window.scrollTo(0,0);
    }

    function showList() {
      editingUserId = null;
      editPage.style.display = 'none';
      listPage.style.display = 'block';
      editPage.setAttribute('aria-hidden','true');
      renderUserList();
    }

    function handleAvatarSelected(e) {
      const file = e.target.files && e.target.files[0];
      if(!file) return;
      const reader = new FileReader();
      reader.onload = function(evt) {
        avatarPreview.src = evt.target.result;
      };
      reader.readAsDataURL(file);
    }

    function resetAvatarToDefault(){
      avatarPreview.src = 'user.png';
      avatarInput.value = '';
    }

    function handleSave(){
      if(editingUserId == null) return;
      const idx = users.findIndex(x=>x.id===editingUserId);
      if(idx === -1) return alert('保存失败：找不到用户');

      users[idx].email = inputEmail.value.trim();
      users[idx].name = inputNickname.value.trim();
      users[idx].bio = inputBio.value;
      users[idx].studentId = inputStudentId.value.trim();
      users[idx].country = selectCountry.value;
      users[idx].province = selectProvince.value;
      users[idx].city = selectCity.value;
      users[idx].password = inputPassword.value.trim();
      users[idx].avatar = avatarPreview.src;

      saveUsers(users);
      alert('用户信息已更新并保存到本地（localStorage）');
      showList();
    }

    function escapeHtml(s){
      if(!s && s !== 0) return '';
      return String(s).replace(/[&<>"']/g, function(m){ return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]; });
    }

    renderUserList();
  </script>
</body>
</html>
